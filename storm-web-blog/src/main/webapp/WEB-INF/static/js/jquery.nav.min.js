layui.use("jquery", function() {
	var n = layui.$;
	(function(n, t, i) {
		var r = function(r, u) {
			this.elem = r;
			this.$elem = n(r);
			this.options = u;
			this.metadata = this.$elem.data("plugin-options");
			this.$win = n(t);
			this.sections = {};
			this.didScroll = !1;
			this.$doc = n(i);
			this.docHeight = this.$doc.height()
		};
		r.prototype = {
			defaults: {
				navItems: "a",
				currentClass: "current",
				changeHash: !1,
				easing: "swing",
				filter: "",
				scrollSpeed: 750,
				scrollThreshold: .5,
				begin: !1,
				end: !1,
				scrollChange: !1
			},
			init: function() {
				this.config = n.extend({}, this.defaults, this.options, this.metadata);
				this.$nav = this.$elem.find(this.config.navItems);
				this.config.filter !== "" && (this.$nav = this.$nav.filter(this.config.filter));
				this.$nav.on("click.onePageNav", n.proxy(this.handleClick, this));
				this.getPositions();
				this.bindInterval();
				this.$win.on("resize.onePageNav", n.proxy(this.getPositions, this));
				return this
			},
			adjustNav: function(n, t) {
				n.$elem.find("." + n.config.currentClass).removeClass(n.config.currentClass);
				t.addClass(n.config.currentClass)
			},
			bindInterval: function() {
				var n = this,
					t;
				n.$win.on("scroll.onePageNav", function() {
					n.didScroll = !0
				});
				n.t = setInterval(function() {
					t = n.$doc.height();
					n.didScroll && (n.didScroll = !1, n.scrollChange());
					t !== n.docHeight && (n.docHeight = t, n.getPositions())
				}, 250)
			},
			getHash: function(n) {
				return n.attr("href").split("#")[1]
			},
			getPositions: function() {
				var t = this,
					i, u, r;
				t.$nav.each(function() {
					i = t.getHash(n(this));
					r = n("#" + i);
					r.length && (u = r.offset().top, t.sections[i] = Math.round(u))
				})
			},
			getSection: function(n) {
				var t = null,
					r = Math.round(this.$win.height() * this.config.scrollThreshold);
				for(var i in this.sections) this.sections[i] - r < n && (t = i);
				return t
			},
			handleClick: function(i) {
				var r = this,
					u = n(i.currentTarget),
					f = u.parent(),
					e = "#" + r.getHash(u);
				f.hasClass(r.config.currentClass) || (r.config.begin && r.config.begin(), r.adjustNav(r, f), r.unbindInterval(), r.scrollTo(e, function() {
					r.config.changeHash && (t.location.hash = e);
					r.bindInterval();
					r.config.end && r.config.end()
				}));
				i.preventDefault()
			},
			scrollChange: function() {
				var i = this.$win.scrollTop(),
					t = this.getSection(i),
					n;
				t !== null && (n = this.$elem.find('a[href$="#' + t + '"]').parent(), n.hasClass(this.config.currentClass) || (this.adjustNav(this, n), this.config.scrollChange && this.config.scrollChange(n)))
			},
			scrollTo: function(t, i) {
				var r = n(t).offset().top;
				n("html, body").animate({
					scrollTop: r
				}, this.config.scrollSpeed, this.config.easing, i)
			},
			unbindInterval: function() {
				clearInterval(this.t);
				this.$win.unbind("scroll.onePageNav")
			}
		};
		r.defaults = r.prototype.defaults;
		n.fn.onePageNav = function(n) {
			return this.each(function() {
				new r(this, n).init()
			})
		}
	})(n, window, document)
});